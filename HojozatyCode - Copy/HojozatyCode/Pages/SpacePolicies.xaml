<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModels="clr-namespace:HojozatyCode.ViewModels"
             xmlns:converters="clr-namespace:HojozatyCode.Converters"
             x:Class="HojozatyCode.Pages.SpacePolicies"
             Shell.TabBarIsVisible="False"
             BackgroundColor="#F8F7FC">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:StringNotEmptyConverter x:Key="StringNotEmptyConverter" />
            <converters:StringToBoolConverter x:Key="StringToBoolConverter" />

            <!-- Colors -->
            <Color x:Key="Primary">#4F378A</Color>
            <Color x:Key="PrimaryLight">#7A67B8</Color>
            <Color x:Key="PrimaryLighter">#B5A8DB</Color>
            <Color x:Key="Background">#F8F7FC</Color>
            <Color x:Key="Surface">#FFFFFF</Color>
            <Color x:Key="Error">#E53935</Color>
            <Color x:Key="OnPrimary">#FFFFFF</Color>
            <Color x:Key="OnBackground">#1A1C2A</Color>
            <Color x:Key="OnSurface">#1A1C2A</Color>
            <Color x:Key="Outline">#E1E0E9</Color>
            <Color x:Key="TextSecondary">#6B6D7C</Color>

            <!-- Styles -->
            <Style x:Key="PageTitle" TargetType="Label">
                <Setter Property="FontSize" Value="24" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="{StaticResource OnBackground}" />
                <Setter Property="Margin" Value="0,0,0,20" />
            </Style>

            <Style x:Key="SectionTitle" TargetType="Label">
                <Setter Property="FontSize" Value="18" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="{StaticResource OnBackground}" />
                <Setter Property="Margin" Value="0,24,0,12" />
            </Style>

            <Style x:Key="PolicyCard" TargetType="Frame">
                <Setter Property="BackgroundColor" Value="{StaticResource Surface}" />
                <Setter Property="BorderColor" Value="{StaticResource Outline}" />
                <Setter Property="CornerRadius" Value="12" />
                <Setter Property="Padding" Value="16" />
                <Setter Property="Margin" Value="0,0,0,12" />
                <Setter Property="HasShadow" Value="True" />
            </Style>

            <Style x:Key="PolicyTitle" TargetType="Label">
                <Setter Property="FontSize" Value="16" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="{StaticResource OnSurface}" />
            </Style>

            <Style x:Key="PolicyDescription" TargetType="Label">
                <Setter Property="FontSize" Value="14" />
                <Setter Property="TextColor" Value="{StaticResource Error}" />
                <Setter Property="LineBreakMode" Value="WordWrap" />
            </Style>

            <Style x:Key="RadioButton" TargetType="RadioButton">
                <Setter Property="VerticalOptions" Value="Center" />
            </Style>

            <Style x:Key="DurationToggle" TargetType="Frame">
                <Setter Property="BackgroundColor" Value="{StaticResource Outline}" />
                <Setter Property="CornerRadius" Value="40" />
                <Setter Property="HeightRequest" Value="56" />
                <Setter Property="Padding" Value="16" />
                <Setter Property="HorizontalOptions" Value="Start" />
            </Style>

            <Style x:Key="DurationInput" TargetType="Entry">
                <Setter Property="FontSize" Value="{StaticResource BodyFontSize}" />
                <Setter Property="TextColor" Value="{StaticResource OnSurface}" />
                <Setter Property="PlaceholderColor" Value="{StaticResource TextSecondary}" />
                <Setter Property="BackgroundColor" Value="Transparent" />
                <Setter Property="HeightRequest" Value="56" />
            </Style>

            <Style x:Key="InputBorder" TargetType="Border">
                <Setter Property="Stroke" Value="{StaticResource Outline}" />
                <Setter Property="StrokeThickness" Value="1" />
                <Setter Property="StrokeShape" Value="RoundRectangle 12" />
                <Setter Property="BackgroundColor" Value="{StaticResource Surface}" />
                <Setter Property="HeightRequest" Value="56" />
                <Setter Property="Padding" Value="16,0" />
            </Style>

            <Style x:Key="PrimaryButton" TargetType="Button">
                <Setter Property="BackgroundColor" Value="{StaticResource Primary}" />
                <Setter Property="TextColor" Value="{StaticResource OnPrimary}" />
                <Setter Property="FontSize" Value="16" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="CornerRadius" Value="12" />
                <Setter Property="HeightRequest" Value="50" />
                <Setter Property="Padding" Value="24,0" />
            </Style>

            <Style x:Key="RuleCard" TargetType="Frame">
                <Setter Property="BackgroundColor" Value="{StaticResource Surface}" />
                <Setter Property="BorderColor" Value="{StaticResource Outline}" />
                <Setter Property="CornerRadius" Value="12" />
                <Setter Property="Padding" Value="16" />
                <Setter Property="Margin" Value="0,0,0,12" />
                <Setter Property="HasShadow" Value="True" />
            </Style>

            <Style x:Key="DeleteButton" TargetType="ImageButton">
                <Setter Property="Source" Value="delete_outline.png" />
                <Setter Property="BackgroundColor" Value="Transparent" />
                <Setter Property="WidthRequest" Value="24" />
                <Setter Property="HeightRequest" Value="24" />
                <Setter Property="Padding" Value="0" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout Padding="24" Spacing="0">
            <Label Text="Space Policies" Style="{StaticResource PageTitle}" />

            <!-- Cancellation Policy -->
            <Label Text="Cancellation Policy" Style="{StaticResource SectionTitle}" />

            <VerticalStackLayout Spacing="12">
                <Frame Style="{StaticResource PolicyCard}">
                    <Grid ColumnDefinitions="*,Auto">
                        <VerticalStackLayout Spacing="4">
                            <Label Text="Flexible" Style="{StaticResource PolicyTitle}" />
                            <Label Text="The guest receives a full refund." Style="{StaticResource PolicyDescription}" />
                            <Label Text="You will not keep any part of the payment if the guest cancels." Style="{StaticResource PolicyDescription}" />
                        </VerticalStackLayout>
                        <RadioButton GroupName="CancellationPolicy"
                                     IsChecked="{Binding SelectedPolicy, Converter={StaticResource StringToBoolConverter}, ConverterParameter=Flexible}"
                                     Style="{StaticResource RadioButton}"
                                     Grid.Column="1" />
                    </Grid>
                </Frame>

                <Frame Style="{StaticResource PolicyCard}">
                    <Grid ColumnDefinitions="*,Auto">
                        <VerticalStackLayout Spacing="4">
                            <Label Text="Moderate" Style="{StaticResource PolicyTitle}" />
                            <Label Text="The guest receives a 50% refund." Style="{StaticResource PolicyDescription}" />
                            <Label Text="You will keep half of the reservation amount if the guest cancels." Style="{StaticResource PolicyDescription}" />
                        </VerticalStackLayout>
                        <RadioButton GroupName="CancellationPolicy"
                                     IsChecked="{Binding SelectedPolicy, Converter={StaticResource StringToBoolConverter}, ConverterParameter=Moderate}"
                                     Style="{StaticResource RadioButton}"
                                     Grid.Column="1" />
                    </Grid>
                </Frame>

                <Frame Style="{StaticResource PolicyCard}">
                    <Grid ColumnDefinitions="*,Auto">
                        <VerticalStackLayout Spacing="4">
                            <Label Text="Strict" Style="{StaticResource PolicyTitle}" />
                            <Label Text="The guest receives only 30% back." Style="{StaticResource PolicyDescription}" />
                            <Label Text="You will keep 70% of the payment if the guest cancels." Style="{StaticResource PolicyDescription}" />
                        </VerticalStackLayout>
                        <RadioButton GroupName="CancellationPolicy"
                                     IsChecked="{Binding SelectedPolicy, Converter={StaticResource StringToBoolConverter}, ConverterParameter=Strict}"
                                     Style="{StaticResource RadioButton}"
                                     Grid.Column="1" />
                    </Grid>
                </Frame>
            </VerticalStackLayout>

            <!-- Fixed Duration -->
            <Label Text="Fixed Duration" Style="{StaticResource SectionTitle}" Margin="0,24,0,0" />

            <Frame Style="{StaticResource DurationToggle}">
                <HorizontalStackLayout Spacing="140" VerticalOptions="EndAndExpand" WidthRequest="330">
                    <Label Text="Is Duration Fixed?" FontSize="16" TextColor="{StaticResource OnSurface}" />
                    <Switch IsToggled="{Binding IsFixedDuration}"
                            ThumbColor="{StaticResource Primary}"
                            OnColor="{StaticResource PrimaryLighter}"/>
                </HorizontalStackLayout>
            </Frame>

            <Border Style="{StaticResource InputBorder}" Margin="0,12,0,0" IsVisible="{Binding IsFixedDuration}">
                <Entry Style="{StaticResource DurationInput}" 
                       Placeholder="Enter duration in hours"
                       Keyboard="Numeric"
                       Text="{Binding FixedDurationInHours, Mode=TwoWay}" />
            </Border>

            <!-- House Rules -->
            <Label Text="House Rules" Style="{StaticResource SectionTitle}" Margin="0,24,0,0" />

            <VerticalStackLayout Spacing="12" Margin="0,0,0,16">
                <Border Style="{StaticResource InputBorder}">
                    <Entry Placeholder="Rule name"
                           Style="{StaticResource DurationInput}"
                           Keyboard="Default"
                           Text="{Binding NewHouseRuleName}" />
                </Border>

                <Border Stroke="{StaticResource Outline}"
                        StrokeThickness="1"
                        StrokeShape="RoundRectangle 12"
                        BackgroundColor="{StaticResource Surface}"
                        Padding="16">
                    <Editor Placeholder="Rule description"
                            HeightRequest="100"
                            Text="{Binding NewHouseRuleDescription}"
                            FontSize="16"
                            TextColor="{StaticResource OnSurface}"
                            AutoSize="TextChanges" />
                </Border>

                <Button Text="Add Rule"
                        Style="{StaticResource PrimaryButton}"
                        Command="{Binding AddHouseRuleCommand}" />
            </VerticalStackLayout>

            <CollectionView ItemsSource="{Binding HouseRules}"
                            EmptyView="No house rules added yet">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame Style="{StaticResource RuleCard}">
                            <VerticalStackLayout Spacing="8">
                                <Label Text="{Binding HouseRuleName}"
                                       FontSize="16"
                                       TextColor="{StaticResource OnSurface}"
                                       FontAttributes="Bold" />

                                <Label Text="{Binding HouseRuleDescription}"
                                       FontSize="14"
                                       TextColor="{StaticResource OnSurface}"
                                       LineBreakMode="WordWrap" />

                                <ImageButton Style="{StaticResource DeleteButton}"
                                             HorizontalOptions="End"
                                             Command="{Binding Source={RelativeSource AncestorType={x:Type viewModels:AddSpaceViewModel}}, Path=DeleteHostRuleCommand}"
                                             CommandParameter="{Binding .}" />
                            </VerticalStackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <Label Text="{Binding ErrorMessage}"
                   FontSize="14"
                   TextColor="{StaticResource Error}"
                   HorizontalOptions="Center"
                   Margin="0,16"
                   IsVisible="{Binding ErrorMessage, Converter={StaticResource StringNotEmptyConverter}}" />

            <Button Text="Review"
                    Style="{StaticResource PrimaryButton}"
                    Margin="0,32"
                    Command="{Binding NavigateToReviewPageCommand}" />
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
