<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:HojozatyCode.ViewModels"
             x:Class="HojozatyCode.Pages.ChoosingHallBooking"
             Title="Venue Details"
             BackgroundColor="{StaticResource PageBackground}">

    <ContentPage.Resources>
        <!-- Color Resources -->
        <Color x:Key="PrimaryColor">#4F378A</Color>
        <Color x:Key="SecondaryText">#718096</Color>
        <Color x:Key="PrimaryText">#2D3748</Color>
        <Color x:Key="CardBackground">#FFFFFF</Color>
        <Color x:Key="PageBackground">#F8F9FA</Color>

        <!-- Styles -->
        <Style TargetType="Label" x:Key="SectionTitle">
            <Setter Property="FontSize" Value="20"/>
            <Setter Property="FontFamily" Value="Montserrat-SemiBold"/>
            <Setter Property="TextColor" Value="{StaticResource PrimaryText}"/>
            <Setter Property="Margin" Value="0,0,0,16"/>
        </Style>

        <Style TargetType="Button" x:Key="HeaderIconButton">
            <Setter Property="BackgroundColor" Value="#20FFFFFF"/>
            <Setter Property="WidthRequest" Value="40"/>
            <Setter Property="HeightRequest" Value="40"/>
            <Setter Property="CornerRadius" Value="20"/>
            <Setter Property="Margin" Value="16"/>
        </Style>
    </ContentPage.Resources>

    <ContentPage.BindingContext>
        <vm:BookingViewModel />
    </ContentPage.BindingContext>

    <Grid RowDefinitions="300,*,Auto">
        <!-- Image Gallery -->
        <Grid Grid.Row="0">
            <CarouselView ItemsSource="{Binding SelectedVenue.ImageUrls}"
                          Loop="False"
                          PeekAreaInsets="20"
                          HorizontalScrollBarVisibility="Never">
                <CarouselView.ItemTemplate>
                    <DataTemplate>
                        <Frame CornerRadius="16" Padding="0" Margin="8" IsClippedToBounds="True">
                            <Image Source="{Binding .}" 
                                   Aspect="AspectFill"
                                   HeightRequest="300"/>
                        </Frame>
                    </DataTemplate>
                </CarouselView.ItemTemplate>
            </CarouselView>

            <!-- Header Buttons -->
            <Button Style="{StaticResource HeaderIconButton}"
                    ImageSource="back_arrow.png"
                    HorizontalOptions="Start"
                    VerticalOptions="Start"/>

            <Button Style="{StaticResource HeaderIconButton}"
                    ImageSource="heartoutline.png"
                    HorizontalOptions="End"
                    VerticalOptions="Start"/>
        </Grid>

        <!-- Content Area -->
        <Frame Grid.Row="1"
               Margin="16,0,16,16"
               Padding="0"
               CornerRadius="24"
               BackgroundColor="{StaticResource CardBackground}"
               HasShadow="True">
            <ScrollView>
                <VerticalStackLayout Spacing="0" Padding="24">
                    <!-- Title -->
                    <Label Text="{Binding SelectedVenue.VenueName}"
                           FontSize="24"
                           FontFamily="Montserrat-Bold"
                           TextColor="{StaticResource PrimaryText}"/>

                    <!-- Basic Info -->
                    <HorizontalStackLayout Spacing="8" Margin="0,16">
                        <Image Source="location.png" HeightRequest="20" WidthRequest="20"/>
                        <Label Text="Amman, Jordan"
                               FontSize="14"
                               FontFamily="Montserrat-Medium"
                               TextColor="{StaticResource SecondaryText}"/>
                    </HorizontalStackLayout>

                    <!-- Stats Card -->
                    <Grid ColumnDefinitions="*,*" Margin="0,24" RowSpacing="12">
                        <VerticalStackLayout>
                            <Label Text="VENUE TYPE"
                                   Style="{StaticResource SecondaryLabel}"/>
                            <Label Text="{Binding SelectedVenue.Type}"
                                   Style="{StaticResource PrimaryLabel}"/>
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="1">
                            <Label Text="CAPACITY"
                                   Style="{StaticResource SecondaryLabel}"/>
                            <Label Text="{Binding SelectedVenue.Capacity}"
                                   Style="{StaticResource PrimaryLabel}"/>
                        </VerticalStackLayout>
                    </Grid>

                    <!-- Features -->
                    <Label Text="Features" Style="{StaticResource SectionTitle}"/>
                    <FlexLayout BindableLayout.ItemsSource="{Binding VenueFeatures}"
                                Wrap="Wrap" 
                                AlignItems="Start"
                                Margin="-4">
                        <BindableLayout.ItemTemplate>
                            <DataTemplate>
                                <Frame BackgroundColor="{StaticResource PageBackground}"
                                       Padding="12,8"
                                       Margin="4"
                                       CornerRadius="12"
                                       HasShadow="False">
                                    <HorizontalStackLayout Spacing="8">
                                        <Image Source="{Binding Icon}" 
                                               HeightRequest="18" 
                                               WidthRequest="18"/>
                                        <Label Text="{Binding Value}"
                                               FontFamily="Montserrat-Medium"
                                               FontSize="14"
                                               TextColor="{StaticResource PrimaryText}"/>
                                    </HorizontalStackLayout>
                                </Frame>
                            </DataTemplate>
                        </BindableLayout.ItemTemplate>
                    </FlexLayout>

                    <!-- About Section -->
                    <Label Text="About" Style="{StaticResource SectionTitle}"/>
                    <Label Text="{Binding SelectedVenue.Description}"
                           FontFamily="Montserrat-Regular"
                           FontSize="14"
                           TextColor="{StaticResource SecondaryText}"
                           LineHeight="1.5"/>

                    <!-- Host Rules -->
                    <Label Text="Host Rules" 
                           Style="{StaticResource SectionTitle}"
                           IsVisible="{Binding HasHostRules}"/>
                    <CollectionView ItemsSource="{Binding HostRulesVenue}"
                                    IsVisible="{Binding HasHostRules}"
                                    Margin="-12,0"
                                    SelectionMode="None">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Grid ColumnDefinitions="24,*" 
                                      Padding="12"
                                      ColumnSpacing="16">
                                    <Image Source="rule_icon.png"
                                           HeightRequest="24"
                                           WidthRequest="24"
                                           VerticalOptions="Center"/>
                                    <VerticalStackLayout Grid.Column="1" Spacing="4">
                                        <Label Text="{Binding HostRuleName}"
                                               FontFamily="Montserrat-SemiBold"
                                               FontSize="14"
                                               TextColor="{StaticResource PrimaryText}"/>
                                        <Label Text="{Binding HostRuleDescription}"
                                               FontFamily="Montserrat-Regular"
                                               FontSize="13"
                                               TextColor="{StaticResource SecondaryText}"/>
                                    </VerticalStackLayout>
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                    <!-- Services -->
                    <Label Text="Services" 
                           Style="{StaticResource SectionTitle}"
                           IsVisible="{Binding HasServices}"/>
                    <CollectionView ItemsSource="{Binding ServicesVenue}"
                                    IsVisible="{Binding HasServices}"
                                    Margin="-12,0"
                                    SelectionMode="None">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Grid ColumnDefinitions="24,*" 
                                      Padding="12"
                                      ColumnSpacing="16">
                                    <Image Source="service_icon.png"
                                           HeightRequest="24"
                                           WidthRequest="24"
                                           VerticalOptions="Center"/>
                                    <VerticalStackLayout Grid.Column="1" Spacing="4">
                                        <Label Text="{Binding Name}"
                                               FontFamily="Montserrat-SemiBold"
                                               FontSize="14"
                                               TextColor="{StaticResource PrimaryText}"/>
                                        <Label Text="{Binding Description}"
                                               FontFamily="Montserrat-Regular"
                                               FontSize="13"
                                               TextColor="{StaticResource SecondaryText}"/>
                                        <Label Text="{Binding Price, StringFormat='{0} JOD'}"
                                               FontFamily="Montserrat-Medium"
                                               FontSize="13"
                                               TextColor="{StaticResource PrimaryColor}"/>
                                    </VerticalStackLayout>
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </ScrollView>
        </Frame>

        <!-- Booking Footer -->
        <Grid Grid.Row="2"
              Padding="24,16"
              BackgroundColor="{StaticResource CardBackground}"
              ColumnDefinitions="*,Auto"
              ColumnSpacing="16">

            <VerticalStackLayout>
                <Label Text="Starting from"
                       FontFamily="Montserrat-Medium"
                       FontSize="12"
                       TextColor="{StaticResource SecondaryText}"/>
                <Label Text="{Binding SelectedVenue.InitialPrice, StringFormat='{0} JOD/hour'}"
                       FontFamily="Montserrat-Bold"
                       FontSize="18"
                       TextColor="{StaticResource PrimaryColor}"/>
            </VerticalStackLayout>

            <Button Text="Book Now"
                    Grid.Column="1"
                    CornerRadius="12"
                    Padding="32,0"
                    HeightRequest="48"
                    BackgroundColor="{StaticResource PrimaryColor}"
                    TextColor="White"
                    FontFamily="Montserrat-Bold"
                    Command="{Binding GoToBookingCalendarPageCommand}"/>
        </Grid>
    </Grid>
</ContentPage>